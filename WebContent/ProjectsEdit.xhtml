<!--
Copyright 2013 Imperial College London

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    template="layout/home_template.xhtml">

<ui:define name="body">

    <h:form id="projects" styleClass="edit">

        <rich:panel>
            <f:facet name="header">#{projectsHome.managed ? 'Edit' : 'Add'} Project</f:facet>


            <s:decorate id="nameField" template="layout/edit.xhtml">
                <ui:define name="label">Identifier</ui:define>
                <h:inputText id="name"
                       required="true"
                           size="45"
                      maxlength="45"
                          value="#{projectsHome.instance.name}"
                      validator="#{projectNameValidator.validate}"
                       disabled="#{projectsHome.managed}">
                    <a:ajax event="blur" render="nameField" bypassUpdates="true" oncomplete="onAjaxRequestComplete()"/>
                </h:inputText>
            </s:decorate>


            <s:decorate id="startDateField" template="layout/edit.xhtml">
                <ui:define name="label">Start date</ui:define>
                <rich:calendar id="startDate" enableManualInput="true"
                          value="#{projectsHome.instance.startDate}" datePattern="dd/MM/yy" />
            </s:decorate>


			<s:decorate id="implementationStartDateField" template="layout/edit.xhtml">
                <ui:define name="label">Implementation start date</ui:define>
                <rich:calendar id="implementationStartDate" enableManualInput="true"
                          value="#{projectsHome.instance.implementationStartDate}" datePattern="dd/MM/yy" />
            </s:decorate>

			
            <s:decorate id="endDateField" template="layout/edit.xhtml">
                <ui:define name="label">End date</ui:define>
                <rich:calendar id="endDate" enableManualInput="true"
                          value="#{projectsHome.instance.endDate}" datePattern="dd/MM/yy" />
            </s:decorate>

			
			<s:decorate id="shortNameField" template="layout/edit.xhtml">
                <ui:define name="label">Label</ui:define>
                <h:inputText id="shortName"
                       required="true"
                           size="45"
                      maxlength="45"
                          value="#{projectsHome.instance.shortName}">
                    <a:ajax event="blur" render="shortNameField" bypassUpdates="true" oncomplete="onAjaxRequestComplete()"/>
                </h:inputText>
            </s:decorate>
			
			
            <s:decorate id="descriptionField" template="layout/edit.xhtml">
                <ui:define name="label">Description</ui:define>
                <h:inputTextarea id="description"
                               cols="80"
                               rows="10"
                              value="#{projectsHome.instance.description}"/>
            </s:decorate>


			<s:decorate id="hostOrganizationField" template="layout/edit.xhtml">
                <ui:define name="label">Host organization</ui:define>
                <h:inputText id="hostOrganization"
                           size="45"
                      maxlength="45"
                          value="#{projectsHome.instance.hostOrganization}">
                    <a:ajax event="blur" render="hostOrganizationField" bypassUpdates="true" oncomplete="onAjaxRequestComplete()"/>
                </h:inputText>
            </s:decorate>


            <s:decorate id="siteStructureField" template="layout/edit.xhtml">
                <ui:define name="label">Site structure</ui:define>
                <h:inputText id="siteStructure"
                           size="45"
                      maxlength="45"
                          value="#{projectsHome.instance.siteStructure}">
                    <a:ajax event="blur" render="siteStructureField" bypassUpdates="true" oncomplete="onAjaxRequestComplete()"/>
                </h:inputText>
            </s:decorate>


            <s:decorate id="typeField" template="layout/edit.xhtml">
                <ui:define name="label">Type</ui:define>
                <h:inputText id="type"
                           size="45"
                      maxlength="45"
                          value="#{projectsHome.instance.type}">
                    <a:ajax event="blur" render="typeField" bypassUpdates="true" oncomplete="onAjaxRequestComplete()"/>
                </h:inputText>
            </s:decorate>

			
            <s:decorate id="activeField" template="layout/edit.xhtml">
                <ui:define name="label">Active</ui:define>
                <h:selectBooleanCheckbox id="active"
                                   required="true"
                                      value="#{projectsHome.instance.active}"/>
            </s:decorate>


            <s:decorate id="groupingField" template="layout/edit.xhtml">
                <ui:define name="label">Grouping</ui:define>
                <h:selectOneMenu id="grouping" value="#{projectsHome.instance.projectGroupings}" required="true">
           			<f:selectItems value="#{projectGroupingsList.resultListAsSelectItems}" itemLabelEscaped="Click to select..."/>
                    <s:convertEntity></s:convertEntity>
           			<a:ajax event="change" render="groupingField" bypassUpdates="true" oncomplete="onAjaxRequestComplete()"/>
                </h:selectOneMenu>
            </s:decorate>

            <div style="clear:both">
                <span class="required">*</span>
                required fields
            </div>

        </rich:panel>

        <div class="actionButtons">

            <h:commandButton id="save"
                          value="Save"
                         action="#{projectsHome.persist}"
                       disabled="#{!projectsHome.wired}"
                       rendered="#{!projectsHome.managed}">
                <s:conversationId/>
            </h:commandButton>

            <h:commandButton id="update"
                          value="Update"
                         action="#{projectsHome.update}"
                       rendered="#{projectsHome.managed}"
                       disabled="#{not identity.hasRole(roleIDs.WRT_ADMIN_id)}">
                <s:conversationId/>
            </h:commandButton>

            <h:commandButton id="delete"
                          value="Delete"
                         action="#{projectsHome.remove}"
                      immediate="true"
                       rendered="#{projectsHome.managed}"
                       disabled="true"/>

            <s:button id="cancelEdit"
                   value="Cancel"
             propagation="end"
                    view="/Projects.xhtml"
                rendered="#{projectsHome.managed}"/>

            <s:button id="cancelAdd"
                   value="Cancel"
             propagation="end"
                    view="/#{empty projectsFrom ? 'ProjectsList' : projectsFrom}.xhtml"
                rendered="#{!projectsHome.managed}"/>

        </div>
    </h:form>

	<rich:collapsiblePanel headerClass="collapsiblePanelHeader" switchType="client" expanded="false"> 
			<f:facet name="headerCollapsed">Project entries (click to expand)</f:facet>
			<f:facet name="headerExpanded">Project entries (click to collapse)</f:facet>
	
		<rich:tabPanel switchType="client" rendered="#{projectsHome.anyActivities()}">
		
		    <rich:tab header="Comments" 
		              rendered="#{not empty projectsHome.comments and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'')}">
		        <h:form styleClass="association" id="commentsChildren">
		
		            <h:outputText value="There are no comments associated with this project."
		                       rendered="#{empty projectsHome.comments}"/>
		
		            <rich:dataTable value="#{projectsHome.comments}"
		                           var="_comment"
		                      rendered="#{not empty projectsHome.comments}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="commentsTable"
		                          rows="10">
		                <rich:column sortBy="#{_comment.id}">
		                    <f:facet name="header">Entry ID</f:facet>
		                    <h:outputText value="#{_comment.id}"/>
		                </rich:column>
		                <rich:column sortBy="#{_comment.eventDate}">
		                    <f:facet name="header">Event date</f:facet>
		                    <h:outputText value="#{_comment.eventDate}">
		                        <f:convertDateTime type="date" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_comment.comment}">
		                    <f:facet name="header">Comment</f:facet>
		                    <h:outputText value="#{_comment.comment}"/>
		                </rich:column>
		                <rich:column sortBy="#{_comment.rcTimestamp}">
		                    <f:facet name="header">Date Entry Made</f:facet>
		                    <h:outputText value="#{_comment.rcTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="commentsTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="comments">
		        <div class="actionButtons">
		            <s:button id="addcomment"
		                   value="Add comment"
		                    view="/CommentEdit.xhtml"
		             propagation="none"
		                  action="#{activeProjectHome.wire(projectsHome.instance.id)}">
		            	 <f:param name="usersId"
		            	         value="#{identity.id}"/>
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="commentFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		
		    <rich:tab header="Sustainability Model" 
		              rendered="#{not empty projectsHome.sustainabilities and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'') and not suspendedModules.isSuspended( 'sustainability' )}">
		        <h:form styleClass="association" id="sustainabilitiesChildren">
		
		            <h:outputText value="There are no Sustainability models associated with this project."
		                       rendered="#{empty projectsHome.sustainabilities}"/>
		
		            <rich:dataTable value="#{projectsHome.sustainabilities}"
		                           var="_sustainability"
		                      rendered="#{not empty projectsHome.sustainabilities}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="sustainabilitiesTable"
		                          rows="10">
		                <rich:column sortBy="#{_sustainability.id}">
		                    <f:facet name="header">Entry ID</f:facet>
		                    <h:outputText value="#{_sustainability.id}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.users.loginName}">
			                <f:facet name="header">User</f:facet>
			                <h:outputText value="#{(identity.id == _sustainability.users.id) or identity.hasRole(roleIDs.WRT_ADMIN_id) ? _sustainability.users.loginName : '*****'}"/>
		            	</rich:column>
		                <rich:column sortBy="#{_sustainability.eventDate}">
		                    <f:facet name="header">Event date</f:facet>
		                    <h:outputText value="#{_sustainability.eventDate}">
		                        <f:convertDateTime type="date" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score1}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score1</f:facet>
		                    <h:outputText value="#{_sustainability.score1}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score2}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score2</f:facet>
		                    <h:outputText value="#{_sustainability.score2}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score3}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score3</f:facet>
		                    <h:outputText value="#{_sustainability.score3}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score4}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score4</f:facet>
		                    <h:outputText value="#{_sustainability.score4}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score5}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score5</f:facet>
		                    <h:outputText value="#{_sustainability.score5}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score6}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score6</f:facet>
		                    <h:outputText value="#{_sustainability.score6}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score7}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score7</f:facet>
		                    <h:outputText value="#{_sustainability.score7}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score8}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score8</f:facet>
		                    <h:outputText value="#{_sustainability.score8}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score9}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score9</f:facet>
		                    <h:outputText value="#{_sustainability.score9}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.score10}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Score10</f:facet>
		                    <h:outputText value="#{_sustainability.score10}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.comment}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Comment</f:facet>
		                    <h:outputText value="#{_sustainability.comment}"/>
		                </rich:column>
		                <rich:column sortBy="#{_sustainability.rcTimestamp}">
		                    <f:facet name="header">Date Entry Made</f:facet>
		                    <h:outputText value="#{_sustainability.rcTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="sustainabilitiesTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="sustainabilities">
		        <div class="actionButtons">
		            <s:button id="addsustainability"
		                   value="Add Sustainability"
		                    view="/SustainabilityEdit.xhtml"
		             propagation="none"
		                  action="#{activeProjectHome.wire(projectsHome.instance.id)}">
		            	 <f:param name="usersId"
		            	         value="#{identity.id}"/>
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="sustainabilityFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		
			<rich:tab header="Project tables" 
			          rendered="#{not empty projectsHome.projectTableses and identity.hasPermission(projectsHome.id,roleIDs.SUPER_ADMIN_id,'')}">
		        <h:form styleClass="association" id="projectTablesesChildren">
		
		            <h:outputText value="There are no project tables associated with this project."
		                       rendered="#{empty projectsHome.projectTableses}"/>
		
		            <rich:dataTable value="#{projectsHome.projectTableses}"
		                           var="_projectTables"
		                      rendered="#{not empty projectsHome.projectTableses}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="projectTablesesTable"
		                          rows="10">
		                <rich:column sortBy="#{_projectTables.id.projectId}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Project id</f:facet>
		                    <h:outputText value="#{_projectTables.id.projectId}"/>
		                </rich:column>
		                <rich:column sortBy="#{_projectTables.id.tableName}">
		                    <f:facet name="header">Table name</f:facet>
		                    <h:outputText value="#{_projectTables.id.tableName}"/>
		                </rich:column>
		            	<rich:column sortBy="#{_projectTables.tableLabel}">
                    		<f:facet name="header">Table label</f:facet>
                    		<h:outputText value="#{_projectTables.tableLabel}"/>
                		</rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="projectTablesesTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="projectTableses">
		        <div class="actionButtons">
		            <s:button id="addprojectTables"
		                   value="Add project table"
		                    view="/ProjectTablesEdit.xhtml"
		             propagation="none"
		                  action="#{activeProjectHome.wire(projectsHome.instance.id)}"
		                  disabled="#{not identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="projectTablesFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		    
		    <rich:tab header="User project roles" 
		    		  rendered="#{not empty projectsHome.userProjectRoleses and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'')}">
		        <h:form styleClass="association" id="userProjectRolesesChildren">
		 
		            <h:outputText value="There are no User Project Roles associated with this project."
		                       rendered="#{empty projectsHome.userProjectRoleses}"/>
		
		            <rich:dataTable value="#{projectsHome.userProjectRoleses}"
		                           var="_userProjectRoles"
		                      rendered="#{not empty projectsHome.userProjectRoleses}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="userProjectRolesesTable"
		                          rows="10">
		                <rich:column sortBy="#{_userProjectRoles.users.loginName}">
		                    <f:facet name="header">User</f:facet>
		                    <h:outputText value="#{_userProjectRoles.users.loginName}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRoles.projects.shortName}">
		                    <f:facet name="header">Project</f:facet>
		                    <h:outputText value="#{_userProjectRoles.projects.shortName}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRoles.roles.name}">
		                    <f:facet name="header">Role</f:facet>
		                    <h:outputText value="#{_userProjectRoles.roles.name}"/>
		                </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="userProjectRolesesTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="userProjectRoleses">
		        <div class="actionButtons">
		            <s:button id="adduserProjectRoles"
		                   value="Add Project Role"
		                    view="/UserProjectRolesCreate.xhtml"
		             propagation="none"
		                  action="#{activeProjectHome.wire(projectsHome.instance.id)}">
		            	 <f:param name="userProjectRolesProjectId" value="#{projectsHome.instance.id}"/>
		                 <f:param name="projectsId" value="#{projectsHome.instance.id}"/>
		                 <f:param name="userProjectRolesFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		
		    <rich:tab header="PPI scores" 
		              rendered="#{not empty projectsHome.ppis and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'') and not suspendedModules.isSuspended( 'ppi' )}">
		        <h:form styleClass="association" id="ppisChildren">
		
		            <h:outputText value="There are no PPI scores associated with this project."
		                       rendered="#{empty projectsHome.ppis}"/>
		
		            <rich:dataTable value="#{projectsHome.ppis}"
		                           var="_ppi"
		                      rendered="#{not empty projectsHome.ppis}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="ppisTable"
		                          rows="10">
		                <rich:column sortBy="#{_ppi.id}">
		                    <f:facet name="header">Entry ID</f:facet>
		                    <h:outputText value="#{_ppi.id}"/>
		                </rich:column>
		                <rich:column sortBy="#{_ppi.users.loginName}">
		                	<f:facet name="header">User</f:facet>
		                	<h:outputText value="#{(identity.id == _ppi.users.id) or identity.hasRole(roleIDs.WRT_ADMIN_id) ? _ppi.users.loginName : '*****'}"/>
		            	</rich:column>
		                <rich:column sortBy="#{_ppi.entryDate}">
		                    <f:facet name="header">Entry date</f:facet>
		                    <h:outputText value="#{_ppi.entryDate}">
		                        <f:convertDateTime type="date" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_ppi.role}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Role</f:facet>
		                    <h:outputText value="#{_ppi.role}"/>
		                </rich:column>
		                <rich:column sortBy="#{_ppi.receptive}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Receptive</f:facet>
		                    <h:outputText value="#{_ppi.receptive}"/>
		                </rich:column>
		                <rich:column sortBy="#{_ppi.difference}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Difference</f:facet>
		                    <h:outputText value="#{_ppi.difference}"/>
		                </rich:column>
		                <rich:column sortBy="#{_ppi.plans}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Plans</f:facet>
		                    <h:outputText value="#{_ppi.plans}"/>
		                </rich:column>
		                <rich:column sortBy="#{_ppi.comments}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Comments</f:facet>
		                    <h:outputText value="#{_ppi.comments}"/>
		                </rich:column>
		                <rich:column sortBy="#{_ppi.rcTimestamp}">
		                    <f:facet name="header">Date Entry Made</f:facet>
		                    <h:outputText value="#{_ppi.rcTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="ppisTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="ppis">
		        <div class="actionButtons">
		            <s:button id="addppi"
		                   value="Add PPI"
		                    view="/PpiEdit.xhtml"
		             propagation="none"
		                  action="#{activeProjectHome.wire(projectsHome.instance.id)}">
		            	 <f:param name="usersId"
		            	         value="#{identity.id}"/>
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="ppiFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		
		    <rich:tab header="PDSA cycles" 
		              rendered="#{not empty projectsHome.pdsas and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'') and not suspendedModules.isSuspended( 'pdsa' )}">
		        <h:form styleClass="association" id="pdsasChildren">
		
		            <h:outputText value="There are no PDSA cycles associated with this project."
		                       rendered="#{empty projectsHome.pdsas}"/>
		
		            <rich:dataTable value="#{projectsHome.pdsas}"
		                           var="_pdsa"
		                      rendered="#{not empty projectsHome.pdsas}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="pdsasTable"
		                          rows="10">
		                <rich:column sortBy="#{_pdsa.id}">
		                    <f:facet name="header">Entry ID</f:facet>
		                    <h:outputText value="#{_pdsa.id}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.users.loginName}">
		                	<f:facet name="header">User</f:facet>
		                	<h:outputText value="#{(identity.id == _pdsa.users.id) or identity.hasRole(roleIDs.WRT_ADMIN_id) ? _pdsa.users.loginName : '*****'}"/>
		            	</rich:column>
		                <rich:column sortBy="#{_pdsa.eventDate}">
		                    <f:facet name="header">Event date</f:facet>
		                    <h:outputText value="#{_pdsa.eventDate}">
		                        <f:convertDateTime type="date" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.description}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Description</f:facet>
		                    <h:outputText value="#{_pdsa.description}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.doDescription}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Do description</f:facet>
		                    <h:outputText value="#{_pdsa.doDescription}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.studyDescription}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Study description</f:facet>
		                    <h:outputText value="#{_pdsa.studyDescription}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.actDescription}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Act description</f:facet>
		                    <h:outputText value="#{_pdsa.actDescription}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.planTeam}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Plan team</f:facet>
		                    <h:outputText value="#{_pdsa.planTeam}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.studyTeam}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Study team</f:facet>
		                    <h:outputText value="#{_pdsa.studyTeam}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.doTeam}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Do team</f:facet>
		                    <h:outputText value="#{_pdsa.doTeam}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.actTeam}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Act team</f:facet>
		                    <h:outputText value="#{_pdsa.actTeam}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.doDate}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Do date</f:facet>
		                    <h:outputText value="#{_pdsa.doDate}">
		                        <f:convertDateTime type="date" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.studyDate}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Study date</f:facet>
		                    <h:outputText value="#{_pdsa.studyDate}">
		                        <f:convertDateTime type="date" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.actDate}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Act date</f:facet>
		                    <h:outputText value="#{_pdsa.actDate}">
		                        <f:convertDateTime type="date" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.cycleTitle}">
		                    <f:facet name="header">Cycle title</f:facet>
		                    <h:outputText value="#{_pdsa.cycleTitle}"/>
		                </rich:column>
		                <rich:column sortBy="#{_pdsa.rcTimestamp}">
		                    <f:facet name="header">Date Entry Made</f:facet>
		                    <h:outputText value="#{_pdsa.rcTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="pdsasTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="pdsas">
		        <div class="actionButtons">
		            <s:button id="addpdsa"
		                   value="Add PDSA"
		                    view="/PdsaEdit.xhtml"
		             propagation="none"
		                  action="#{activeProjectHome.wire(projectsHome.instance.id)}">
		            	 <f:param name="usersId"
		            	         value="#{identity.id}"/>
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="pdsaFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		    
		    <rich:tab header="User messages" 
		              rendered="#{not empty projectsHome.userMessageses and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'')}">
		        <h:form styleClass="association" id="userMessagesesChildren">
		
		            <h:outputText value="There are no User Messages associated with this project."
		                       rendered="#{empty projectsHome.userMessageses}"/>
		
		            <rich:dataTable value="#{projectsHome.userMessageses}"
		                           var="_userMessages"
		                      rendered="#{not empty projectsHome.userMessageses}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="userMessagesesTable"
		                          rows="10">
		                <rich:column sortBy="#{_userMessages.users.loginName}">
		                    <f:facet name="header">User</f:facet>
		                    <h:outputText value="#{(identity.id == _userMessages.users.id) or identity.hasRole(roleIDs.WRT_ADMIN_id) ? _userMessages.users.loginName : '*****'}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userMessages.projects.shortName}">
		                    <f:facet name="header">Project</f:facet>
		                    <h:outputText value="#{_userMessages.projects.shortName}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userMessages.id.rcTimestamp}">
		                    <f:facet name="header">Date Entry Made</f:facet>
		                    <h:outputText value="#{_userMessages.id.rcTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_userMessages.message}">
		                    <f:facet name="header">Message</f:facet>
		                    <h:outputText value="#{_userMessages.message}"/>
		                </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="userMessagesesTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="userMessageses">
		        <div class="actionButtons">
		            <s:button id="adduserMessages"
		                   value="Add user message"
		                    view="/UserMessagesEdit.xhtml"
		             propagation="none"
		                disabled="true">
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="userMessagesFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		
			<rich:tab header="Project role requests" 
		              rendered="#{not empty projectsHome.userProjectRoleRequestses and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'')}">
		        <h:form styleClass="association" id="userProjectRoleRequestsesChildren">
		
		            <h:outputText value="There are no Project Role Requests associated with this project."
		                       rendered="#{empty projectsHome.userProjectRoleRequestses}"/>
		
		            <rich:dataTable value="#{projectsHome.userProjectRoleRequestses}"
		                           var="_userProjectRoleRequests"
		                      rendered="#{not empty projectsHome.userProjectRoleRequestses}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="userProjectRoleRequestsesTable"
		                          rows="10">
		                <rich:column sortBy="#{_userProjectRoleRequests.users.loginName}">
			                <f:facet name="header">User</f:facet>
			                <h:outputText value="#{_userProjectRoleRequests.users.loginName}"/>
			            </rich:column>
			            <rich:column sortBy="#{_userProjectRoleRequests.projects.shortName}">
			                <f:facet name="header">Project</f:facet>
			                <h:outputText value="#{_userProjectRoleRequests.projects.shortName}"/>
			            </rich:column>
			            <rich:column sortBy="#{_userProjectRoleRequests.roles.name}">
			                <f:facet name="header">Role</f:facet>
			                <h:outputText value="#{_userProjectRoleRequests.roles.name}"/>
			            </rich:column>
			            <rich:column sortBy="#{_userProjectRoleRequests.rcTimestamp}">
			                <f:facet name="header">Date Request Made</f:facet>
			                <h:outputText value="#{_userProjectRoleRequests.rcTimestamp}">
			                    <f:convertDateTime type="both" dateStyle="short"/>
			                </h:outputText>
			            </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="userProjectRoleRequestsesTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="userProjectRoleRequestses">
		        <div class="actionButtons">
		            <s:button id="adduserProjectRoleRequests"
		                   value="Add Project Role Request"
		                    view="/UserProjectRoleRequestsCreate.xhtml"
		             propagation="none">
		                 <f:param name="userProjectRoleRequestsUserId" value="#{identity.id}"/>
            			 <f:param name="userProjectRoleRequestsProjectId" value="#{projectsHome.instance.id}"/>
            			 <f:param name="usersId" value="#{identity.id}"/>
            			 <f:param name="projectsId" value="#{projectsHome.instance.id}"/>
            			 <f:param name="rolesId" value="#{roleIDs.PROJECT_VIEWER_id}"/>
		                 <f:param name="userProjectRoleRequestsFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		
		    <rich:tab header="Project role audits" 
		              rendered="#{not empty projectsHome.userProjectRolesAudits and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'')}">
		        <h:form styleClass="association" id="userProjectRolesAuditsChildren">
		
		            <h:outputText value="There are no Project Roles Audits associated with this project."
		                       rendered="#{empty projectsHome.userProjectRolesAudits}"/>
		
		            <rich:dataTable value="#{projectsHome.userProjectRolesAudits}"
		                           var="_userProjectRolesAudit"
		                      rendered="#{not empty projectsHome.userProjectRolesAudits}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="userProjectRolesAuditsTable"
		                          rows="10">
		                <rich:column sortBy="#{_userProjectRolesAudit.id}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
	                    <f:facet name="header">Id</f:facet>
	                    <h:outputText value="#{_userProjectRolesAudit.id}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRolesAudit.usersByUserId.loginName}">
		                    <f:facet name="header">User</f:facet>
		                    <h:outputText value="#{_userProjectRolesAudit.usersByUserId.loginName}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRolesAudit.projects.shortName}">
		                    <f:facet name="header">Project</f:facet>
		                    <h:outputText value="#{_userProjectRolesAudit.projects.shortName}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRolesAudit.roles.name}">
			                <f:facet name="header">Role</f:facet>
			                <h:outputText value="#{_userProjectRolesAudit.roles.name}"/>
			            </rich:column>
		                <rich:column sortBy="#{_userProjectRolesAudit.reqTimestamp}">
		                    <f:facet name="header">Date Request Made</f:facet>
		                    <h:outputText value="#{_userProjectRolesAudit.reqTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRolesAudit.action}">
		                    <f:facet name="header">Action</f:facet>
		                    <h:outputText value="#{_userProjectRolesAudit.action}"/>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRolesAudit.resTimestamp}">
		                    <f:facet name="header">Date Action Done</f:facet>
		                    <h:outputText value="#{_userProjectRolesAudit.resTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		                <rich:column sortBy="#{_userProjectRolesAudit.usersByAdminId.loginName}">
		                    <f:facet name="header">Admin</f:facet>
		                    <h:outputText value="#{_userProjectRolesAudit.usersByAdminId.loginName}"/>
		                </rich:column>
		            </rich:dataTable>
		            <rich:dataScroller for="userProjectRolesAuditsTable" renderIfSinglePage="false"/>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="userProjectRolesAudits">
		        <div class="actionButtons">
		            <s:button id="adduserProjectRolesAudit"
		                   value="Add Project Roles Audit"
		                    view="/UserProjectRolesAuditEdit.xhtml"
		             propagation="none" 
                        disabled="true">
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="userProjectRolesAuditFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		    <rich:tab header="Data collections" 
		              rendered="#{not empty projectsHome.dataCollectionses and identity.hasPermission(projectsHome.id,roleIDs.PROJECT_ADMIN_id,'')}">
		        <h:form styleClass="association" id="dataCollectionsesChildren">
		
		            <h:outputText value="There are no Data Collections associated with this project."
		                       rendered="#{empty projectsHome.dataCollectionses}"/>
		
		            <rich:dataTable value="#{projectsHome.dataCollectionses}"
		                           var="_dataCollections"
		                      rendered="#{not empty projectsHome.dataCollectionses}"
		                    rowClasses="rvgRowOne,rvgRowTwo"
		                            id="dataCollectionsesTable"
		                          rows="10">
		                <rich:column sortBy="#{_dataCollections.id}" rendered="#{identity.hasRole(roleIDs.SUPER_ADMIN_id)}">
		                    <f:facet name="header">Id</f:facet>
		                    <h:outputText value="#{_dataCollections.id}"/>
		                </rich:column>
		                <rich:column sortBy="#{_dataCollections.name}">
		                    <f:facet name="header">Name</f:facet>
		                    <h:outputText value="#{_dataCollections.name}"/>
		                </rich:column>
		                <rich:column sortBy="#{_dataCollections.label}">
		                    <f:facet name="header">Label</f:facet>
		                    <h:outputText value="#{_dataCollections.label}"/>
		                </rich:column>
		                <rich:column sortBy="#{_dataCollections.description}">
		                    <f:facet name="header">Description</f:facet>
		                    <h:outputText value="#{_dataCollections.description}"/>
		                </rich:column>
		                <rich:column sortBy="#{_dataCollections.rcTimestamp}">
		                    <f:facet name="header">Data Entry Made</f:facet>
		                    <h:outputText value="#{_dataCollections.rcTimestamp}">
		                        <f:convertDateTime type="both" dateStyle="short"/>
		                    </h:outputText>
		                </rich:column>
		            </rich:dataTable>
		
		        </h:form>
		
		        <f:subview rendered="#{projectsHome.managed}" id="dataCollectionses">
		        <div class="actionButtons">
		            <s:button id="adddataCollections"
		                   value="Add Data collection"
		                    view="/DataCollectionsEdit.xhtml"
		             propagation="none">
		                 <f:param name="usersId"
		                         value="#{identity.id}"/>
		                 <f:param name="projectsId"
		                         value="#{projectsHome.instance.id}"/>
		                 <f:param name="dataCollectionsFrom" value="Projects"/>
		            </s:button>
		        </div>
		        </f:subview>
		    </rich:tab>
		</rich:tabPanel>
		
	</rich:collapsiblePanel>
	
</ui:define>

</ui:composition>
